---
title: MySQL性能优化
date: 2023-02-15 14:07:13
tags:
---
![image.png](https://cdn.staticaly.com/gh/K-Viior/blog-image@master/img/20230215142245.png)
## 硬件和操作系统层面的优化
从硬件层面上，影响MySQL性能的因素有CPU，可用内存大小，磁盘读写速度，网络带宽
## 架构设计层面上的优化
### 1、搭建MySQL主从集群
单个MySQL服务容易出现单点故障，一旦出现故障宕机，将导致依赖MySQL的应用无法使用。
使用主从集群或主主集群能够保证服务的高可用性。
### 2、采用读写分离
在读多写少的场景中，可以通过读写分离的方案，避免读写冲突导致的性能影响
### 3、分库分表
通过分库可以降低单个服务器节点的IO压力
通过分表可以降低单表数据量，提高SQL查询的效率
### 4、对热点数据，采用更高效的分布式数据库
使用Redis、MongoDB等做缓存，分担MySQL的访问压力，同时提高查询效率。
## 索引优化
### 1、索引设计原则
- 对查询频次较高，且数据量比较大的表，建立索引
- 索引的字段应当从where字句的条件中去提取，如果条件较多，就挑选最常用和区分效果最好的字段
- 使用唯一索引，索引区分度越高，索引的效率越高
- 索引并非越多越好，对于增、删、改较为频繁的表慎重简历索引，索引过多还会降低索引维护的效率
- 使用短索引，提高索引访问时的IO效率
- 建立复合索引时，要遵循最左前缀原则
  - 复合索引的命名规则：`index_表名_列名一_列名二_列名三`
  - 比如`create index idx_student_name_age_addr on tb_student(name,age,address)`
### 2、避免索引失效
- 在查询时使用了复合索引，要遵循最左前缀原则，查询时从索引的最左列开始，且不能跳过中间的列
- 模糊查询使用like字句时，%不能够放在最前面，如‘%aaa’
- 不能对索引列使用四则运算和内部函数，否则将导致索引失效
- 如果在where字句中使用or来连接条件，要保证前后的字段都有索引，如果其中一个没有索引，那么左右两边的索引都会失效
- 不要在where字句中对索引字段进行null值判断，否则引擎将放弃使用索引而进行全表扫描
- 不要在where字句中对索引字段使用不等号（!= ，<>），否则引擎将放弃使用索引而进行全表扫描
## SQL语句调优
- 根据业务场景建立符合索引，只查询业务需要的字段，如果这些字段被索引覆盖，则会极大的增加查询效率
- 多表连接的字段上需要建立索引，可以提高表连接的效率
- where字句的条件上需要建立索引，但是where的条件不能够使用函数和进行运算，以免索引失效
- 排序字段由于排序效率低，添加索引能够提高查询效率
- 优化insert语句，批量插入语句比单列插入数据效率高
- 再使用order by语句时，不要使用select * ,select 后面要跟有索引的字段。如果select后面要跟多个字段，在不影响业务的前提下，尽量同时用升序或同时用降序
- 使用group by对数据进行分类时，MySQL会默认进行排序，但是如果排序不是我们业务所需的，额外的排序会降低执行效率，可以使用`order by null`禁用排序
  - 如：`select age count(*) from emp group by age order by null`
- 尽量避免子查询，可以将子查询优化为join多表连接查询

